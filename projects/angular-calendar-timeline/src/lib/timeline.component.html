<timeline-panel
  (widthChanged)="panelWidth = $event"
  [width]="panelWidth"
  [maxWidth]="maxPanelWidth"
  [minWidth]="minPanelWidth"
  [resizable]="isPanelResizable"
  [itemTemplate]="panelItemTemplate"
  [label]="panelLabel"
  [headerHeight]="headerHeight"
  [items]="itemsIterator.items"
  [locale]="locale"
  [rowHeight]="rowHeight">
</timeline-panel>

<div class='content-wrapper'>
  <timeline-scale-header
    [height]="headerHeight"
    [formatter]="scaleGenerator.formatter"
    [zoom]='zoom'
    [scale]='scale'
    [locale]="locale"
  ></timeline-scale-header>

  <div class="column-separators">
    <ng-container *ngFor='let date of scale?.columns; index as i; trackBy: _trackById'>
      <div class="line" *ngIf="!columnSeparatorTemplate"
           [style.left.px]='zoom.columnWidth * (i + 1)'
           [style.height]="'calc(100% - ' + headerHeight + 'px)'">
      </div>

      <ng-template [ngTemplateOutlet]="columnSeparatorTemplate"
                   [ngTemplateOutletContext]="{column: date, index: i, columnWidth: zoom.columnWidth, headerHeight: headerHeight}">
      </ng-template>
    </ng-container>
  </div>

  <timeline-date-marker *ngIf="showDateMarket"
                        [leftPosition]="dateMarkerLeftPosition"
                        [headerHeight]="headerHeight"
                        [scale]="scale"
                        [customTemplate]="dateMarkerTemplate"
  ></timeline-date-marker>

  <div class='timeline-items' *ngIf="!itemsIterator.isEmpty()">
    <ng-container *ngFor='let group of itemsIterator.items; trackBy: _trackById;'>
      <ng-container *ngIf="!group.stream">
        <div [style.height.px]='rowHeight' class='item-row'>
          <ng-container [ngTemplateOutlet]='itemTemplate'
                        [ngTemplateOutletContext]='{$implicit: group}'
          ></ng-container>
        </div>
      </ng-container>

      <ng-container [ngTemplateOutlet]='itemsIterationTemplate'
                    [ngTemplateOutletContext]='{$implicit: group}'
      ></ng-container>
    </ng-container>

    <ng-template #itemTemplate let-item>
      <timeline-item [item]='item'
                     [scale]="scale"
                     [height]="itemHeight"
                     [locale]="locale"
                     (itemResized)="_onItemResized($event.event, $event.item)"
                     (itemMoved)="_onItemMoved($event.event, $event.item)"
                     [contentTemplate]='itemContentTemplate'
      ></timeline-item>
    </ng-template>

    <ng-template #itemsIterationTemplate let-group>
      <ng-container *ngIf='group.expanded && !group._streamLevels'>
        <div *ngFor='let item of (group.items || []); trackBy: _trackById;'>
          <div [style.height.px]='rowHeight' class='item-row'>
            <ng-container [ngTemplateOutlet]="itemTemplate"
                          [ngTemplateOutletContext]="{$implicit: item}"
            ></ng-container>
          </div>

          <ng-container [ngTemplateOutlet]='itemsIterationTemplate'
                        [ngTemplateOutletContext]='{$implicit: item}'
          ></ng-container>
        </div>
      </ng-container>

      <ng-container *ngIf="group._streamLevels">

        <div *ngFor='let stream of (group._streamLevels || []); trackBy: _trackById;'>
          <div [style.height.px]='rowHeight' class='item-row'>
            <ng-container *ngFor="let item of stream">
              <ng-container [ngTemplateOutlet]="itemTemplate"
                            [ngTemplateOutletContext]="{$implicit: item}"
              ></ng-container>
            </ng-container>
          </div>
        </div>
      </ng-container>
    </ng-template>
  </div>
</div>
